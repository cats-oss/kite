<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=images/favicon.png><meta name=generator content="mkdocs-1.1, mkdocs-material-5.1.0"><title>kite</title><link rel=stylesheet href=assets/stylesheets/main.89dc9fe3.min.css><link rel=stylesheet href=assets/stylesheets/palette.ecd4686e.min.css><meta name=theme-color content=#ef5350><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Open Sans",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=manifest href=manifest.webmanifest crossorigin=use-credentials></head> <body dir=ltr data-md-color-primary=red data-md-color-accent=red> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#kite class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=. title=kite class="md-header-nav__button md-logo" aria-label=kite> <svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewbox="0 0 16 16"><path fill-rule=evenodd d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z /></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> kite </span> <span class="md-header-nav__topic md-ellipsis"> Overview </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z /></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/cats-oss/kite/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> cats-oss/kite </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=. title=kite class="md-nav__button md-logo" aria-label=kite> <svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewbox="0 0 16 16"><path fill-rule=evenodd d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg> </a> kite </label> <div class=md-nav__source> <a href=https://github.com/cats-oss/kite/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> cats-oss/kite </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Overview <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z /></svg> </span> </label> <a href=. title=Overview class="md-nav__link md-nav__link--active"> Overview </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#download class=md-nav__link> Download </a> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> <nav class=md-nav aria-label=Usage> <ul class=md-nav__list> <li class=md-nav__item> <a href=#start-kite-dsl class=md-nav__link> Start Kite DSL </a> </li> <li class=md-nav__item> <a href=#create-state class=md-nav__link> Create State </a> </li> <li class=md-nav__item> <a href=#subscribe-to-state-change class=md-nav__link> Subscribe to State Change </a> </li> <li class=md-nav__item> <a href=#use-coroutine class=md-nav__link> Use Coroutine </a> </li> <li class=md-nav__item> <a href=#setget-contextual-value class=md-nav__link> Set/Get Contextual Value </a> </li> <li class=md-nav__item> <a href=#di-support class=md-nav__link> DI Support </a> </li> <li class=md-nav__item> <a href=#test class=md-nav__link> Test </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#credits class=md-nav__link> Credits </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=changelog/ title="Change Log" class=md-nav__link> Change Log </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> API <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=API data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> API </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=api/kite-core/ title=kite-core class=md-nav__link> kite-core </a> </li> <li class=md-nav__item> <a href=api/kite-runtime/ title=kite-runtime class=md-nav__link> kite-runtime </a> </li> <li class=md-nav__item> <a href=api/kite-testing/ title=kite-testing class=md-nav__link> kite-testing </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#download class=md-nav__link> Download </a> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> <nav class=md-nav aria-label=Usage> <ul class=md-nav__list> <li class=md-nav__item> <a href=#start-kite-dsl class=md-nav__link> Start Kite DSL </a> </li> <li class=md-nav__item> <a href=#create-state class=md-nav__link> Create State </a> </li> <li class=md-nav__item> <a href=#subscribe-to-state-change class=md-nav__link> Subscribe to State Change </a> </li> <li class=md-nav__item> <a href=#use-coroutine class=md-nav__link> Use Coroutine </a> </li> <li class=md-nav__item> <a href=#setget-contextual-value class=md-nav__link> Set/Get Contextual Value </a> </li> <li class=md-nav__item> <a href=#di-support class=md-nav__link> DI Support </a> </li> <li class=md-nav__item> <a href=#test class=md-nav__link> Test </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#credits class=md-nav__link> Credits </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/cats-oss/kite/edit/master/docs/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/></svg> </a> <h1 id=kite>kite<a class=headerlink href=#kite title="Permanent link">&para;</a></h1> <p><a href=https://www.android.com/history/ ><img alt="Android API" src="https://img.shields.io/badge/API-14%2B-blue.svg?label=API&maxAge=300"></a> <a href=https://opensource.org/licenses/Apache-2.0><img alt=License src=https://img.shields.io/badge/License-Apache%202.0-blue.svg></a></p> <p><strong><em>This project is currently in development and the API subject to breaking changes without notice.</em></strong></p> <p>A Kotlin DSL to bind Android UI components to your app state.</p> <h2 id=download>Download<a class=headerlink href=#download title="Permanent link">&para;</a></h2> <p>// TODO</p> <h2 id=usage>Usage<a class=headerlink href=#usage title="Permanent link">&para;</a></h2> <h3 id=start-kite-dsl>Start Kite DSL<a class=headerlink href=#start-kite-dsl title="Permanent link">&para;</a></h3> <p>You can create a <code>KiteDslScope</code> from either Activity or Fragment via extension function <code>kiteDsl</code>:</p> <p>In <code>Actvity</code>:</p> <div class=highlight><pre><span></span><code><span class=k>override</span> <span class=k>fun</span> <span class=nf>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>?)</span> <span class=p>{</span>
  <span class=k>super</span><span class=p>.</span><span class=n>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>)</span>
  <span class=n>kiteDsl</span> <span class=p>{</span>
    <span class=c1>// Write Kite DSL here</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>In <code>Fragment</code>:</p> <div class=highlight><pre><span></span><code><span class=k>override</span> <span class=k>fun</span> <span class=nf>onViewCreated</span><span class=p>(</span><span class=n>view</span><span class=p>:</span> <span class=n>View</span><span class=p>,</span> <span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>?)</span> <span class=p>{</span>
  <span class=n>kiteDsl</span> <span class=p>{</span>
    <span class=c1>// Write Kite DSL here</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <h3 id=create-state>Create State<a class=headerlink href=#create-state title="Permanent link">&para;</a></h3> <p>In the <code>KiteDslScope</code>, you can create state via extension function <code>state</code>:</p> <div class=highlight><pre><span></span><code><span class=n>kiteDsl</span> <span class=p>{</span>
  <span class=c1>// Create a state with initial value</span>
  <span class=k>val</span> <span class=py>count</span> <span class=p>=</span> <span class=n>state</span> <span class=p>{</span> <span class=m>0</span> <span class=p>}</span>
  <span class=c1>// Assign a new value</span>
  <span class=n>count</span><span class=p>.</span><span class=n>value</span> <span class=p>=</span> <span class=m>3</span>
  <span class=c1>// Read the value</span>
  <span class=n>println</span><span class=p>(</span><span class=n>count</span><span class=p>.</span><span class=n>value</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div> <p>When you create <code>kiteDsl</code> inside <code>Activity/Fragment</code>, all declared states will be saved into an Android <code>ViewModel</code>. So states can survive after <code>Activity/Fragment</code> recreation.</p> <h3 id=subscribe-to-state-change>Subscribe to State Change<a class=headerlink href=#subscribe-to-state-change title="Permanent link">&para;</a></h3> <p>You can create a action that will rerun when its dependent states changed via extension function <code>subscribe</code>:</p> <div class=highlight><pre><span></span><code><span class=k>val</span> <span class=py>count</span> <span class=p>=</span> <span class=n>state</span> <span class=p>{</span> <span class=m>0</span> <span class=p>}</span>

<span class=c1>// When click the button, textView.text will change.</span>
<span class=n>subscribe</span> <span class=p>{</span>
  <span class=n>textView</span><span class=p>.</span><span class=n>text</span> <span class=p>=</span> <span class=n>count</span><span class=p>.</span><span class=n>value</span><span class=p>.</span><span class=n>toString</span><span class=p>()</span>
<span class=p>}</span>

<span class=n>button</span><span class=p>.</span><span class=n>setOnClickListener</span> <span class=p>{</span>
  <span class=n>count</span><span class=p>.</span><span class=n>value</span><span class=p>++</span>
<span class=p>}</span>
</code></pre></div> <p>You can subscribe to more than one state:</p> <div class=highlight><pre><span></span><code><span class=k>val</span> <span class=py>count1</span> <span class=p>=</span> <span class=n>state</span> <span class=p>{</span> <span class=m>0</span> <span class=p>}</span>
<span class=k>val</span> <span class=py>count2</span> <span class=p>=</span> <span class=n>state</span> <span class=p>{</span> <span class=m>0</span> <span class=p>}</span>

<span class=c1>// Whether count1 or count2 changed, the textView.text will change.</span>
<span class=n>subscribe</span> <span class=p>{</span>
  <span class=n>textView</span><span class=p>.</span><span class=n>text</span> <span class=p>=</span> <span class=p>(</span><span class=n>count1</span><span class=p>.</span><span class=n>value</span> <span class=p>+</span> <span class=n>count2</span><span class=p>.</span><span class=n>value</span><span class=p>).</span><span class=n>toString</span><span class=p>()</span>
<span class=p>}</span>
</code></pre></div> <p>The action will only rerun when its referenced state changed:</p> <div class=highlight><pre><span></span><code><span class=k>val</span> <span class=py>count1</span> <span class=p>=</span> <span class=n>state</span> <span class=p>{</span> <span class=m>0</span> <span class=p>}</span>
<span class=k>val</span> <span class=py>count2</span> <span class=p>=</span> <span class=n>state</span> <span class=p>{</span> <span class=m>0</span> <span class=p>}</span>

<span class=c1>// Will only rerun when count1 changed</span>
<span class=n>subscribe</span> <span class=p>{</span>
  <span class=n>textView1</span><span class=p>.</span><span class=n>text</span> <span class=p>=</span> <span class=n>count1</span><span class=p>.</span><span class=n>value</span><span class=p>.</span><span class=n>toString</span><span class=p>()</span>
<span class=p>}</span>

<span class=c1>// Will only rerun when count2 changed</span>
<span class=n>subscribe</span> <span class=p>{</span>
  <span class=n>textView2</span><span class=p>.</span><span class=n>text</span> <span class=p>=</span> <span class=n>count2</span><span class=p>.</span><span class=n>value</span><span class=p>.</span><span class=n>toString</span><span class=p>()</span>
<span class=p>}</span>
</code></pre></div> <h3 id=use-coroutine>Use Coroutine<a class=headerlink href=#use-coroutine title="Permanent link">&para;</a></h3> <p><code>KiteDslScope</code> implemented <code>CoroutineScope</code>, so you can use coroutine inside <code>KiteDslScope</code>:</p> <div class=highlight><pre><span></span><code><span class=k>val</span> <span class=py>count</span> <span class=p>=</span> <span class=n>state</span> <span class=p>{</span> <span class=m>0</span> <span class=p>}</span>

<span class=n>button</span><span class=p>.</span><span class=n>setOnClickListener</span> <span class=p>{</span>
  <span class=n>launch</span> <span class=p>{</span>
    <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span>
    <span class=n>count1</span><span class=p>.</span><span class=n>value</span><span class=p>++</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <h3 id=setget-contextual-value>Set/Get Contextual Value<a class=headerlink href=#setget-contextual-value title="Permanent link">&para;</a></h3> <p>You can set some contextual value inside <code>KiteDslScope</code> and then get them later:</p> <div class=highlight><pre><span></span><code><span class=k>fun</span> <span class=nc>KiteDslScope</span><span class=p>.</span><span class=nf>setCount</span><span class=p>()</span> <span class=p>{</span>
  <span class=k>val</span> <span class=py>count</span> <span class=p>=</span> <span class=n>state</span> <span class=p>{</span> <span class=m>0</span> <span class=p>}</span>
  <span class=k>set</span><span class=p>(</span><span class=s>&quot;count&quot;</span><span class=p>,</span> <span class=n>count</span><span class=p>)</span>
<span class=p>}</span>

<span class=k>fun</span> <span class=nc>KiteDslScope</span><span class=p>.</span><span class=nf>getCount</span><span class=p>()</span> <span class=p>{</span>
  <span class=n>setCount</span><span class=p>()</span>
  <span class=k>val</span> <span class=py>count</span> <span class=p>=</span> <span class=k>get</span><span class=p>&lt;</span><span class=n>KiteMutableState</span><span class=p>&lt;</span><span class=n>Int</span><span class=p>&gt;&gt;(</span><span class=s>&quot;count&quot;</span><span class=p>)</span> <span class=c1>// nullable</span>
  <span class=k>val</span> <span class=py>count</span> <span class=p>=</span> <span class=n>require</span><span class=p>&lt;</span><span class=n>KiteMutableState</span><span class=p>&lt;</span><span class=n>Int</span><span class=p>&gt;&gt;(</span><span class=s>&quot;count&quot;</span><span class=p>)</span> <span class=c1>// non null</span>
<span class=p>}</span>
</code></pre></div> <h3 id=di-support>DI Support<a class=headerlink href=#di-support title="Permanent link">&para;</a></h3> <p>You can construct a <code>KiteScopeModelFactory</code> and add any dependencies needed into it via <code>addService</code>:</p> <div class=highlight><pre><span></span><code><span class=n>@Provide</span>
<span class=k>fun</span> <span class=nf>provideKiteScopeModelFactory</span><span class=p>(</span><span class=n>repository</span><span class=p>:</span> <span class=n>Repository</span><span class=p>):</span> <span class=n>KiteScopeModelFactory</span> <span class=p>{</span>
  <span class=k>return</span> <span class=n>KiteScopeModelFactory</span><span class=p>().</span><span class=n>apply</span> <span class=p>{</span>
    <span class=n>addService</span><span class=p>(</span><span class=n>repository</span><span class=p>)</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>Then initialize <code>kiteDsl</code> with injected <code>KiteScopeModelFactory</code>. Now all services added into <code>KiteScopeModelFactory</code> will set into <code>KiteDslScope</code> as contextual value:</p> <div class=highlight><pre><span></span><code><span class=n>@Inject</span>
<span class=k>lateinit</span> <span class=k>var</span> <span class=py>scopeModelFactory</span><span class=p>:</span> <span class=n>KiteScopeModelFactory</span>

<span class=n>kiteDsl</span><span class=p>(</span><span class=n>scopeModelFactory</span> <span class=p>=</span> <span class=n>scopeModelFactory</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>val</span> <span class=py>repository</span> <span class=p>=</span> <span class=n>requireByType</span><span class=p>&lt;</span><span class=n>Repository</span><span class=p>&gt;()</span>
<span class=p>}</span>
</code></pre></div> <h3 id=test>Test<a class=headerlink href=#test title="Permanent link">&para;</a></h3> <p>It&rsquo;s better not to directly write Kite DSL inside <code>Activity/Fragment</code>. Instead, separate your business logic and UI binding into separate extension functions of <code>KiteDslScope</code>:</p> <div class=highlight><pre><span></span><code><span class=k>data</span> <span class=k>class</span> <span class=nc>CounterUseCase</span><span class=p>(</span>
  <span class=k>val</span> <span class=py>count</span><span class=p>:</span> <span class=n>KiteState</span><span class=p>&lt;</span><span class=n>Int</span><span class=p>&gt;,</span>
  <span class=k>val</span> <span class=py>increment</span><span class=p>:</span> <span class=p>()</span> <span class=p>-&gt;</span> <span class=n>Unit</span><span class=p>,</span>
  <span class=k>val</span> <span class=py>decrement</span><span class=p>:</span> <span class=p>()</span> <span class=p>-&gt;</span> <span class=n>Unit</span>
<span class=p>)</span>

<span class=k>fun</span> <span class=nc>KiteDslScope</span><span class=p>.</span><span class=nf>counterUseCase</span><span class=p>():</span> <span class=n>CounterUseCase</span> <span class=p>{</span>
  <span class=k>val</span> <span class=py>count</span> <span class=p>=</span> <span class=n>state</span> <span class=p>{</span> <span class=m>0</span> <span class=p>}</span>
  <span class=k>return</span> <span class=n>CounterUseCase</span><span class=p>(</span>
    <span class=n>count</span> <span class=p>=</span> <span class=n>count</span><span class=p>,</span>
    <span class=n>increment</span> <span class=p>=</span> <span class=p>{</span> <span class=n>count</span><span class=p>.</span><span class=n>value</span><span class=p>++</span> <span class=p>},</span>
    <span class=n>decrement</span> <span class=p>=</span> <span class=p>{</span> <span class=n>count</span><span class=p>.</span><span class=n>value</span><span class=p>--</span> <span class=p>}</span>
  <span class=p>)</span>
<span class=p>}</span>

<span class=k>fun</span> <span class=nc>KiteDslScope</span><span class=p>.</span><span class=nf>bindCounter</span><span class=p>(</span><span class=n>counterUseCase</span><span class=p>:</span> <span class=n>CounterUseCase</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>val</span> <span class=py>binding</span> <span class=p>=</span> <span class=n>requireByType</span><span class=p>&lt;</span><span class=n>FragmentCounterBinding</span><span class=p>&gt;()</span>
  <span class=n>subscribe</span> <span class=p>{</span>
    <span class=n>binding</span><span class=p>.</span><span class=n>textView</span><span class=p>.</span><span class=n>text</span> <span class=p>=</span> <span class=n>counterUseCase</span><span class=p>.</span><span class=n>count</span><span class=p>.</span><span class=n>toString</span><span class=p>()</span>
  <span class=p>}</span>

  <span class=n>binding</span><span class=p>.</span><span class=n>incrementButton</span><span class=p>.</span><span class=n>setOnClickListener</span> <span class=p>{</span>
    <span class=n>counterUseCase</span><span class=p>.</span><span class=n>increment</span><span class=p>.</span><span class=n>invoke</span><span class=p>()</span>
  <span class=p>}</span>

  <span class=n>binding</span><span class=p>.</span><span class=n>decrementButton</span><span class=p>.</span><span class=n>setOnClickListener</span> <span class=p>{</span>
    <span class=n>counterUseCase</span><span class=p>.</span><span class=n>decrement</span><span class=p>.</span><span class=n>invoke</span><span class=p>()</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>Now you can test business logic via <code>runTestKiteDsl</code>:</p> <div class=highlight><pre><span></span><code><span class=n>@Test</span>
<span class=k>fun</span> <span class=nf>testCounter</span><span class=p>()</span> <span class=p>=</span> <span class=n>runTestKiteDsl</span> <span class=p>{</span>
  <span class=k>val</span> <span class=py>counter</span> <span class=p>=</span> <span class=n>counterUseCase</span><span class=p>()</span>
  <span class=n>assert</span><span class=p>(</span><span class=n>counter</span><span class=p>.</span><span class=n>count</span><span class=p>.</span><span class=n>value</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span>
  <span class=n>counter</span><span class=p>.</span><span class=n>increment</span><span class=p>.</span><span class=n>invoke</span><span class=p>()</span>
  <span class=n>assert</span><span class=p>(</span><span class=n>counter</span><span class=p>.</span><span class=n>count</span><span class=p>.</span><span class=n>value</span> <span class=p>==</span> <span class=m>1</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div> <p>Test UI with <code>TestKiteActivity</code> or <code>TestKiteFragment</code>:</p> <div class=highlight><pre><span></span><code><span class=n>@Test</span>
<span class=k>fun</span> <span class=nf>testDisplayCount</span><span class=p>()</span> <span class=p>=</span> <span class=n>runTestKiteDsl</span> <span class=p>{</span>
  <span class=k>val</span> <span class=py>factory</span> <span class=p>=</span> <span class=n>TestKiteFragment</span><span class=p>.</span><span class=n>makeFactory</span><span class=p>(</span>
    <span class=n>R</span><span class=p>.</span><span class=n>layout</span><span class=p>.</span><span class=n>fragment_counter</span><span class=p>,</span>
    <span class=n>TestKiteFragment</span><span class=p>.</span><span class=n>Config</span> <span class=p>{</span>
      <span class=n>setByType</span><span class=p>(</span><span class=n>FragmentCounterBinding</span><span class=p>.</span><span class=n>bind</span><span class=p>(</span><span class=n>it</span><span class=p>.</span><span class=n>requireView</span><span class=p>()))</span>
      <span class=k>val</span> <span class=py>count</span> <span class=p>=</span> <span class=n>state</span> <span class=p>{</span> <span class=m>3</span> <span class=p>}</span>
      <span class=k>val</span> <span class=py>counter</span> <span class=p>=</span> <span class=n>CounterUseCase</span><span class=p>(</span>
        <span class=n>count</span> <span class=p>=</span> <span class=n>count</span><span class=p>,</span>
        <span class=n>increment</span> <span class=p>=</span> <span class=p>{},</span>
        <span class=n>decrement</span> <span class=p>=</span> <span class=p>{}</span>
      <span class=p>)</span>
      <span class=n>bindCounter</span><span class=p>(</span><span class=n>counter</span><span class=p>)</span>
    <span class=p>}</span>
  <span class=p>)</span>
  <span class=n>launchFragmentInContainer</span><span class=p>&lt;</span><span class=n>TestKiteFragment</span><span class=p>&gt;(</span><span class=n>factory</span> <span class=p>=</span> <span class=n>factory</span><span class=p>)</span>
    <span class=p>.</span><span class=n>moveToState</span><span class=p>(</span><span class=n>Lifecycle</span><span class=p>.</span><span class=n>State</span><span class=p>.</span><span class=n>RESUMED</span><span class=p>)</span>
  <span class=n>Espresso</span><span class=p>.</span><span class=n>onView</span><span class=p>(</span><span class=n>ViewMatchers</span><span class=p>.</span><span class=n>withText</span><span class=p>(</span><span class=s>&quot;3&quot;</span><span class=p>))</span>
    <span class=p>.</span><span class=n>check</span><span class=p>(</span><span class=n>ViewAssertions</span><span class=p>.</span><span class=n>matches</span><span class=p>(</span><span class=n>ViewMatchers</span><span class=p>.</span><span class=n>isDisplayed</span><span class=p>()))</span>
<span class=p>}</span>
</code></pre></div> <h2 id=credits>Credits<a class=headerlink href=#credits title="Permanent link">&para;</a></h2> <p>This library is inspired by <a href=https://github.com/vuejs/vue>Vue</a>, and <a href=https://github.com/facebook/react>React</a>.</p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=changelog/ title="Change Log" class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Change Log </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z /></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <script src=assets/javascripts/vendor.36cbf620.min.js></script> <script src=assets/javascripts/bundle.00c583dd.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: ".",
          features: [],
          search: Object.assign({
            worker: "assets/javascripts/worker/search.7f7c8775.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>